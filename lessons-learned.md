# 学んだ教訓の記録

このドキュメントは、プロジェクト開発中に直面した問題とそこから学んだ教訓を記録し、同じ問題の再発を防ぐためのものです。

## 教訓記録テンプレート

新たな教訓を記録する際は、以下のテンプレートを使用してください：

```
## [問題のタイトル]

### 日付
YYYY-MM-DD

### 発生状況
[問題が発生した状況の詳細な説明]

### 原因
[発生した根本的な原因の分析]

### 影響
[問題による影響とその範囲]

### 解決策
[問題を解決するために行った対応]

### 学んだ教訓
[今後同様の問題を防ぐための知見]

### 予防策
- [再発防止のための具体的な対策1]
- [再発防止のための具体的な対策2]
- [再発防止のための具体的な対策3]

### 関連リソース
- [関連するドキュメントやリソースへのリンク]
```

## 記録された教訓

### API仕様の誤解による実装ミス

#### 日付
2025-03-22

#### 発生状況
プロジェクトでCursorを使用してAPI機能の実装方法について質問すると、不正確なAPI仕様が提案されたり、要件にない機能が追加で実装されることがあった。

#### 原因
最新のAPI仕様書を適切に参照せず、AIアシスタントの生成した情報を検証なしに採用していた。

#### 影響
- 機能実装の手戻りが発生
- 不要な機能による複雑化
- デバッグ時間の増加

#### 解決策
最新のAPI仕様書を常に参照し、AIアシスタントが提案するコードを実装前に仕様書と照合するプロセスを導入した。

#### 学んだ教訓
AIツールは便利だが、その出力は必ず公式のドキュメントで検証する必要がある。特にAPI実装においては、正確な仕様理解が不可欠。

#### 予防策
- API仕様書を常に最新の状態で管理し、実装前に必ず参照する
- 実装前にエンドポイント、パラメータ、レスポンス形式を文書化する
- AIツールの提案は参考程度にとどめ、最終判断は公式ドキュメントに基づいて行う
- API仕様変更の通知を定期的にチェックする仕組みを導入する

#### 関連リソース
- [API実装チェックリスト](./api-specs/implementation-checklist.md)

---

### ライブラリ互換性問題によるアプリ障害

#### 日付
2025-03-22

#### 発生状況
HTTPライブラリのバージョン変更により、突然アプリが通信できなくなる事態が発生した。

#### 原因
ライブラリのバージョンを明示的に指定していなかったため、依存関係の自動更新により互換性のないバージョンがインストールされた。

#### 影響
- アプリケーションの完全停止
- 緊急対応による開発リソースの消費
- ユーザー体験の悪化

#### 解決策
すべてのライブラリとその依存関係に対して、バージョンを明示的に固定した。また、標準ライブラリを含むすべての依存関係を明示的に記録するプロセスを導入した。

#### 学んだ教訓
標準ライブラリを含むすべての依存関係は、常に特定のバージョンに固定する必要がある。「最新版」に自動アップデートする設定は危険。

#### 予防策
- `requirements.txt`や`package.json`でのバージョン固定を徹底する
- 依存関係のロックファイル（`package-lock.json`、`poetry.lock`など）を必ずバージョン管理する
- ライブラリ更新前に開発環境とステージング環境でテストを実施する
- 定期的な依存関係の監査と更新スケジュールを設定する

#### 関連リソース
- [ライブラリバージョン管理ガイドライン](./libraries/version-management.md)

---

### インフラ構成の最適化不足

#### 日付
2025-03-22

#### 発生状況
新規要件に対応するためにインフラ構成を変更する必要が生じたが、既存のインフラ構成の理由や背景が不明確で、最適な変更を判断できなかった。

#### 原因
インフラ選択の理由や背景が適切に文書化されておらず、なぜその構成になっているのかの理解が共有されていなかった。

#### 影響
- 不必要に複雑なインフラ構成
- コスト効率の低下
- スケーラビリティの制約

#### 解決策
現在のインフラ構成を詳細に文書化し、各コンポーネントの選択理由と制約条件を明確にした。また、新たな要件に対してインフラ構成を見直すプロセスを導入した。

#### 学んだ教訓
インフラ構成の選択理由と背景は常に文書化し、新たな要件に対して適切に評価・検討する必要がある。

#### 予防策
- インフラ構成図と選択理由を常に最新の状態で文書化する
- 新規要件ごとにインフラ構成の見直しを行う
- インフラコストとパフォーマンスの定期的な評価を実施する
- インフラ設計の決定をコード（IaC）として管理する

#### 関連リソース
- [インフラ構成管理ガイドライン](./infrastructure/management-guideline.md)

---

### API制約考慮不足によるパフォーマンス問題

#### 日付
2025-03-22

#### 発生状況
APIのレート制限やリクエスト制限を考慮せずに実装を進めたため、本番環境で予期せぬパフォーマンス低下やエラーが発生した。

#### 原因
API仕様書のレート制限やリクエスト制限に関する情報を事前に確認せず、これらの制約を考慮したアーキテクチャ設計やエラーハンドリングが不足していた。

#### 影響
- 予期せぬAPIエラーの発生
- 処理の遅延とタイムアウト
- ユーザー体験の悪化
- 開発の手戻り

#### 解決策
すべてのAPIについて制約情報を明確に文書化し、レート制限に対応するためのリトライロジックやキューイングシステムを実装した。また、APIの使用状況をモニタリングする仕組みを導入した。

#### 学んだ教訓
APIを利用する際は、機能面だけでなく、制約条件（レート制限、サイズ制限など）を事前に把握し、それに適したアーキテクチャを設計することが重要。

#### 予防策
- API利用前に制約情報を明確に文書化する
- レート制限に対応するためのリトライ戦略を実装する
- APIリクエストのキューイングやバッチ処理を検討する
- API使用状況のモニタリングとアラート設定を行う

#### 関連リソース
- [API制約管理ガイドライン](./api-constraints.md)
